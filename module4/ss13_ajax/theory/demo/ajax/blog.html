<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>List Blog</h1>
<input type="text" id="txt-search" placeholder="Search By Author">
<button id="btn-search">Search</button>
<button id="moreSearch">More...</button>
<input type="text" id="page" value="0" hidden>
<hr>
<table border="1px">
    <thead>
    <tr>
        <th>STT</th>
        <th>Author</th>
        <th>Catagory</th>
    </tr>
    </thead>
    <tbody>
    </tbody>
</table>
<button id="more">More...</button>
<input type="text" id="page-number" value="0" hidden>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>

    $(document).ready(function () {

        function init() {
            $.ajax({
                url: "http://localhost:8080/api/blog/v1",
                type: "GET",
                dataType: "json",
                success: function (data) {
                    console.log(data);
                    let tr = [];
                    for (let i = 0; i < data.length; i++) {
                        tr.push("<tr>")
                        tr.push("<td>" + (i + 1) + "</td>")
                        tr.push("<td>" + data[i].author + "</td>")
                        tr.push("<td>" + data[i].catagory.name + "</td>")
                        tr.push("</tr>")
                    }
                    $("tbody").append(tr.join(""))
                }
            })
        }

        $("#more").click(function () {
            let pageNumber = parseInt($("#page-number").val());
            $("#page-number").val(pageNumber + 1);
            $.ajax({
                url: "http://localhost:8080/api/blog/v1?page=" + (pageNumber + 1),
                type: "GET",
                dataType: "json",
                success: function (data) {
                    let tr = [];
                    if (data) {
                        for (let i = 0; i < data.length; i++) {
                            tr.push("<tr>")
                            tr.push("<td>" + ((2 * (pageNumber + 1)) + i + 1) + "</td>")
                            tr.push("<td>" + data[i].author + "</td>")
                            tr.push("<td>" + data[i].catagory.name + "</td>")
                            tr.push("</tr>")
                        }
                    } else {
                        tr.push("<tr>")
                        tr.push("<td colspan='3'> No data ..... </td>")
                        tr.push("</tr>")
                        $("#more").hide();
                    }
                    $("tbody").append(tr.join(""));
                }
            })
        })

        $("#btn-search").click(function () {
            $("#more").hide();
            $("tbody").empty();
            $.ajax({
                url: "http://localhost:8080/api/blog/v1/search?authorSearch=" + $("#txt-search").val(),
                type: "GET",
                dataType: "json",
                success: function (data) {
                    console.log(data);
                    let tr = [];
                    for (let i = 0; i < data.length; i++) {
                        tr.push("<tr>")
                        tr.push("<td>" + i + 1 + "</td>")
                        tr.push("<td>" + data[i].author + "</td>")
                        tr.push("<td>" + data[i].catagory.name + "</td>")
                        tr.push("</tr>")
                    }
                    $("tbody").append(tr.join(""))
                }
            })
        })

        $("#moreSearch").click(function () {
            let pageNumber = parseInt($("#page").val());
            $("#page").val(pageNumber + 1);
            $.ajax({
                url: "http://localhost:8080/api/blog/v1/search?page=" + (pageNumber + 1) + "&authorSearch=" + $("#txt-search").val(),
                type: "GET",
                dataType: "json",
                success: function (data) {
                    let tr = [];
                        for (let i = 0; i < data.length; i++) {
                            tr.push("<tr>")
                            tr.push("<td>" + ((2 * (pageNumber + 1)) + i + 1) + "</td>")
                            tr.push("<td>" + data[i].author + "</td>")
                            tr.push("<td>" + data[i].catagory.name + "</td>")
                            tr.push("</tr>")
                    }
                    $("tbody").append(tr.join(""));
                }
            })
        })
        init();
    })
</script>
</body>
</html>